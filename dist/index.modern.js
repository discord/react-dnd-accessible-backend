function e(e){var t,n;if(null!=e)return null!=(t=null!=(n=e.getAttribute("data-dnd-name"))?n:e.getAttribute("aria-label"))?t:e.innerText}const t={pickedUpItem:(t,n)=>{var i;return`Picked up ${null!=(i=e(n))?i:t}`},droppedItem:(t,n)=>{var i;return`Dropped ${null!=(i=e(n))?i:t}`},hoveredTarget:(t,n)=>{var i;return`Over ${null!=(i=e(n))?i:t}`},canceledDrag:(t,n)=>{var i;return`Stopped dragging ${null!=(i=e(n))?i:t}`}};function n(){return t}class i{constructor({getAnnouncementMessages:e,announcer:t}={}){if(this.announcer=void 0,this.externalAnnouncer=void 0,this.getMessages=void 0,this.getMessages=null!=e?e:n,this.externalAnnouncer=!1,null!=t)this.announcer=t,this.externalAnnouncer=!0;else{const e=require("@react-aria/live-announcer");this.announcer={announce:e.announce,clearAnnouncements:e.clearAnnouncer,destroy:e.destroyAnnouncer}}}announce(e,t,n){this.announcer.announce(e,t,n)}announceDrag(e,t){null!=e&&this.announce(this.getMessages().pickedUpItem(t,e))}announceHover(e,t){null!=e&&this.announce(this.getMessages().hoveredTarget(t,e))}announceDrop(e,t){this.announce(this.getMessages().droppedItem(t,e))}announceCancel(e,t){this.announce(this.getMessages().canceledDrag(t,e))}clear(){this.announcer.clearAnnouncements()}destroy(){var e,t;this.externalAnnouncer||null==(e=(t=this.announcer).destroy)||e.call(t)}}class r{constructor(e,{previewerClassName:t}={}){var n,i,r;this.document=void 0,this.container=void 0,this.svg=void 0,this.foreignObject=void 0,this.document=e,this.container=null==(n=this.document)?void 0:n.createElement("div"),this.svg=null==(i=this.document)?void 0:i.createElement("svg"),this.foreignObject=null==(r=this.document)?void 0:r.createElement("foreignObject"),null!=this.container&&null!=this.svg&&null!=this.foreignObject&&(t?this.container.className=t:(this.container.className="drag-previewer",this.container.style.cssText="z-index: 1000;"),this.svg.appendChild(this.foreignObject),this.container.appendChild(this.svg))}attach(){var e;null!=this.container&&(null==(e=this.document)||e.body.appendChild(this.container))}detach(){var e;const t=null==(e=this.document)?void 0:e.body;null!=this.container&&null!=t&&t.contains(this.container)&&t.removeChild(this.container)}createDragPreview(e){if(null==this.container||null==this.svg||null==this.foreignObject)return;const{width:t,height:n}=e.getBoundingClientRect();this.svg.setAttribute("viewBox",`0 0 ${t} ${n}`),this.svg.setAttribute("width",`${t}`),this.svg.setAttribute("height",`${n}`),this.foreignObject.setAttribute("x","0"),this.foreignObject.setAttribute("y","0"),this.foreignObject.setAttribute("width",`${t}`),this.foreignObject.setAttribute("height",`${n}`);const i=e.cloneNode(!0);this.foreignObject.appendChild(i)}render(e){const t=this.container;if(null==t)return;const n=e.getSourceClientOffset();null!=n&&e.isDragging()&&(t.style.position="fixed",t.style.left=`${n.x+30}px`,t.style.top=`${n.y+15}px`)}clear(){null!=this.foreignObject&&(this.foreignObject.innerHTML="")}}function o(e){if(null==e)return{x:0,y:0};const t=e.nodeType===Node.ELEMENT_NODE?e:e.parentElement;if(!t)return{x:0,y:0};const{top:n,left:i}=t.getBoundingClientRect();return{x:i,y:n}}function s(e){e.preventDefault(),e.stopImmediatePropagation()}var a;!function(e){e.UP="ArrowUp",e.DOWN="ArrowDown",e.DROP="Shift",e.CANCEL="Escape"}(a||(a={}));class c{constructor(e,t,n,i,r){this.targetNodes=void 0,this.manager=void 0,this.previewer=void 0,this.announcer=void 0,this.currentHoveredNode=void 0,this.focusManager=void 0,this.actions=void 0,this.monitor=void 0,this.handleDraggedElementKeyDown=e=>{switch(e.key){case a.UP:return s(e),void this.hoverNode(this.getPreviousDropTarget());case a.DOWN:return s(e),void this.hoverNode(this.getNextDropTarget())}},this.targetNodes=t,this.manager=n,this.previewer=i,this.announcer=r,this.currentHoveredNode=e,this.focusManager=function({getFocusableElements:e}){return{getNextFocusableElement:function(t){const n=(null==t?void 0:t.from)||document.activeElement;if(null==n)return null;const i=e(),r=i.find(e=>!!(n.compareDocumentPosition(e)&(Node.DOCUMENT_POSITION_FOLLOWING|Node.DOCUMENT_POSITION_CONTAINED_BY)));var o;return null==r&&null!=t&&t.wrap?null!=(o=i[0])?o:null:r},getPreviousFocusableElement:function(t){const n=(null==t?void 0:t.from)||document.activeElement;if(null==n)return null;const i=e();for(let e=i.length-1;e>=0;e--){const t=i[e];if(n.compareDocumentPosition(t)&(Node.DOCUMENT_POSITION_PRECEDING|Node.DOCUMENT_POSITION_CONTAINED_BY))return t}var r;return null!=t&&t.wrap&&null!=(r=i[i.length-1])?r:null},getFirstFocusableElement:function(){var t;return null!=(t=e()[0])?t:null},getLastFocusableElement:function(){var t;const n=e();return null!=(t=n[n.length-1])?t:null}}}({getFocusableElements:()=>this.getViableTargets(t)}),this.actions=n.getActions(),this.monitor=n.getMonitor(),window.addEventListener("keydown",this.handleDraggedElementKeyDown,{capture:!0})}disconnect(){window.removeEventListener("keydown",this.handleDraggedElementKeyDown,{capture:!0})}hoverNode(e){var t;const n=null==(t=Array.from(this.targetNodes.entries()).find(([t,n])=>e===n))?void 0:t[0];null!=n&&(this.actions.hover([n],{clientOffset:o(e)}),this.currentHoveredNode=e,this.previewer.render(this.monitor),this.announcer.announceHover(e,n),null==e||e.focus())}getNextDropTarget(){var e;return this.focusManager.getNextFocusableElement({wrap:!1,from:null!=(e=this.currentHoveredNode)?e:void 0})}getPreviousDropTarget(){var e;return this.focusManager.getPreviousFocusableElement({wrap:!1,from:null!=(e=this.currentHoveredNode)?e:void 0})}getViableTargets(e){return this.getAllowedTargets(e).sort((e,t)=>{if(e===t)return 0;const n=e.compareDocumentPosition(t);return n&(Node.DOCUMENT_POSITION_FOLLOWING|n&Node.DOCUMENT_POSITION_CONTAINED_BY)?-1:n&(Node.DOCUMENT_POSITION_PRECEDING|n&Node.DOCUMENT_POSITION_CONTAINS)?1:0})}getAllowedTargets(e){return null==this.monitor.getItemType()?Array.from(e.values()):Array.from(e).reduce((e,[t,n])=>(this.manager.getMonitor().canDropOnTarget(t)&&e.push(n),e),[])}}function u(e,t=!1){var n;return!(!t||!1!==e.isTrusted)||"d"===(null==(n=e.key)?void 0:n.toLowerCase())&&(e.metaKey||e.ctrlKey)&&!e.altKey}const l=[" ","Enter"],h=["Escape"];function d(e,t){return t.includes(e.key)}class g{constructor(e,t,n){var a;this.manager=void 0,this.actions=void 0,this.monitor=void 0,this.context=void 0,this.options=void 0,this.sourceNodes=void 0,this.sourcePreviewNodes=void 0,this.sourcePreviewNodeOptions=void 0,this.targetNodes=void 0,this._navigator=void 0,this._previewer=void 0,this._announcer=void 0,this._isDragTrigger=void 0,this._handlingFirstEvent=!1,this.handleGlobalKeyDown=e=>{if(this.monitor.isDragging()&&d(e,h)){this.endDrag(e);const t=String(this.monitor.getSourceId()),n=this.sourceNodes.get(t);this._announcer.announceCancel(null!=n?n:null,t)}},this.getSourceClientOffset=e=>o(this.sourceNodes.get(e)),this.handleDragStart=(e,t)=>{var n;if(!this._isDragTrigger(t,this._handlingFirstEvent))return;if(this._handlingFirstEvent=!1,!this.monitor.canDragSource(e))return;if(this.monitor.isDragging())return void this.actions.publishDragSource();s(t);const i=this.sourceNodes.get(e);null!=i&&(this._navigator=new c(i,this.targetNodes,this.manager,this._previewer,this._announcer),this._previewer.createDragPreview(null!=(n=this.sourcePreviewNodes.get(e))?n:i),this.actions.beginDrag([e],{clientOffset:this.getSourceClientOffset(e),getSourceClientOffset:this.getSourceClientOffset,publishSource:!1}),this._previewer.render(this.monitor),this.setDndMode(!0),this._announcer.announceDrag(i,e))},this.handleDrop=e=>{if(!d(e,l))return;const t=String(this.monitor.getSourceId()),n=this.sourceNodes.get(t);this._announcer.announceDrop(null!=n?n:null,t),this.actions.drop(),this.endDrag(e)},this.manager=e,this.actions=e.getActions(),this.monitor=e.getMonitor(),this.context=t,this.options=n,this._isDragTrigger=null!=(a=null==n?void 0:n.isDragTrigger)?a:u,this.sourceNodes=new Map,this.sourcePreviewNodes=new Map,this.sourcePreviewNodeOptions=new Map,this.targetNodes=new Map,this._previewer=new r(t.document,n),this._announcer=new i(n)}setup(){var e;if(g.isSetUp)throw new Error("Cannot have two Keyboard backends at the same time.");g.isSetUp=!0,this._handlingFirstEvent=!0,null==(e=this.context.window)||e.addEventListener("keydown",this.handleGlobalKeyDown,{capture:!0}),this._previewer.attach()}teardown(){var e;g.isSetUp=!1,null==(e=this.context.window)||e.removeEventListener("keydown",this.handleGlobalKeyDown,{capture:!0}),this.endDrag(),this._previewer.detach(),this._announcer.destroy()}setDndMode(e){var t;null==(t=this.options)||null==t.onDndModeChanged||t.onDndModeChanged(e)}profile(){return{sourcePreviewNodes:this.sourcePreviewNodes.size,sourcePreviewNodeOptions:this.sourcePreviewNodeOptions.size,sourceNodes:this.sourceNodes.size}}connectDragSource(e,t){const n=this.handleDragStart.bind(this,e);return this.sourceNodes.set(e,t),t.addEventListener("keydown",n),()=>{this.sourceNodes.delete(e),t.removeEventListener("keydown",n)}}connectDragPreview(e,t,n){return this.sourcePreviewNodeOptions.set(e,n),this.sourcePreviewNodes.set(e,t),()=>{this.sourcePreviewNodes.delete(e),this.sourcePreviewNodeOptions.delete(e)}}connectDropTarget(e,t){return this.targetNodes.set(e,t),t.addEventListener("keydown",this.handleDrop),t.tabIndex=Math.max(-1,t.tabIndex),()=>{this.targetNodes.delete(e),t.removeEventListener("keydown",this.handleDrop)}}endDrag(e){var t;null!=e&&s(e),null==(t=this._navigator)||t.disconnect(),this._previewer.clear(),this.monitor.isDragging()&&this.actions.endDrag(),this.setDndMode(!1)}}g.isSetUp=void 0;const v=(e,t,n)=>new g(e,t,n);export{g as KeyboardBackend,v as default,u as isKeyboardDragTrigger};
//# sourceMappingURL=index.modern.js.map
