function e(e){var n,t;if(null!=e)return null!=(n=null!=(t=e.getAttribute("data-dnd-name"))?t:e.getAttribute("aria-label"))?n:e.innerText}var n={pickedUpItem:function(n,t){var r;return"Picked up "+(null!=(r=e(t))?r:n)},droppedItem:function(n,t){var r;return"Dropped "+(null!=(r=e(t))?r:n)},hoveredTarget:function(n,t){var r;return"Over "+(null!=(r=e(t))?r:n)},canceledDrag:function(n,t){var r;return"Stopped dragging "+(null!=(r=e(t))?r:n)}};function t(){return n}var r,i=function(){function e(e){var n=void 0===e?{}:e,r=n.getAnnouncementMessages,i=n.announcer;if(this.announcer=void 0,this.externalAnnouncer=void 0,this.getMessages=void 0,this.getMessages=null!=r?r:t,this.externalAnnouncer=!1,null!=i)this.announcer=i,this.externalAnnouncer=!0;else{var o=require("@react-aria/live-announcer");this.announcer={announce:o.announce,clearAnnouncements:o.clearAnnouncer,destroy:o.destroyAnnouncer}}}var n=e.prototype;return n.announce=function(e,n,t){this.announcer.announce(e,n,t)},n.announceDrag=function(e,n){null!=e&&this.announce(this.getMessages().pickedUpItem(n,e))},n.announceHover=function(e,n){null!=e&&this.announce(this.getMessages().hoveredTarget(n,e))},n.announceDrop=function(e,n){this.announce(this.getMessages().droppedItem(n,e))},n.announceCancel=function(e,n){this.announce(this.getMessages().canceledDrag(n,e))},n.clear=function(){this.announcer.clearAnnouncements()},n.destroy=function(){var e,n;this.externalAnnouncer||null==(e=(n=this.announcer).destroy)||e.call(n)},e}(),o=function(){function e(e,n){var t,r,i,o=(void 0===n?{}:n).previewerClassName;this.document=void 0,this.container=void 0,this.svg=void 0,this.foreignObject=void 0,this.document=e,this.container=null==(t=this.document)?void 0:t.createElement("div"),this.svg=null==(r=this.document)?void 0:r.createElement("svg"),this.foreignObject=null==(i=this.document)?void 0:i.createElement("foreignObject"),null!=this.container&&null!=this.svg&&null!=this.foreignObject&&(o?this.container.className=o:(this.container.className="drag-previewer",this.container.style.cssText="z-index: 1000;"),this.svg.appendChild(this.foreignObject),this.container.appendChild(this.svg))}var n=e.prototype;return n.attach=function(){var e;null!=this.container&&(null==(e=this.document)||e.body.appendChild(this.container))},n.detach=function(){var e,n=null==(e=this.document)?void 0:e.body;null!=this.container&&null!=n&&n.contains(this.container)&&n.removeChild(this.container)},n.createDragPreview=function(e){if(null!=this.container&&null!=this.svg&&null!=this.foreignObject){var n=e.getBoundingClientRect(),t=n.width,r=n.height;this.svg.setAttribute("viewBox","0 0 "+t+" "+r),this.svg.setAttribute("width",""+t),this.svg.setAttribute("height",""+r),this.foreignObject.setAttribute("x","0"),this.foreignObject.setAttribute("y","0"),this.foreignObject.setAttribute("width",""+t),this.foreignObject.setAttribute("height",""+r);var i=e.cloneNode(!0);this.foreignObject.appendChild(i)}},n.render=function(e){var n=this.container;if(null!=n){var t=e.getSourceClientOffset();null!=t&&e.isDragging()&&(n.style.position="fixed",n.style.left=t.x+30+"px",n.style.top=t.y+15+"px")}},n.clear=function(){null!=this.foreignObject&&(this.foreignObject.innerHTML="")},e}();function s(e){if(null==e)return{x:0,y:0};var n=e.nodeType===Node.ELEMENT_NODE?e:e.parentElement;if(!n)return{x:0,y:0};var t=n.getBoundingClientRect();return{x:t.left,y:t.top}}function a(e){e.preventDefault(),e.stopImmediatePropagation()}!function(e){e.UP="ArrowUp",e.DOWN="ArrowDown",e.DROP="Shift",e.CANCEL="Escape"}(r||(r={}));var u=function(){function e(e,n,t,i,o){var s,u=this;this.targetNodes=void 0,this.manager=void 0,this.previewer=void 0,this.announcer=void 0,this.currentHoveredNode=void 0,this.focusManager=void 0,this.actions=void 0,this.monitor=void 0,this.handleDraggedElementKeyDown=function(e){switch(e.key){case r.UP:return a(e),void u.hoverNode(u.getPreviousDropTarget());case r.DOWN:return a(e),void u.hoverNode(u.getNextDropTarget())}},this.targetNodes=n,this.manager=t,this.previewer=i,this.announcer=o,this.currentHoveredNode=e,this.focusManager=(s=function(){return u.getViableTargets(n)},{getNextFocusableElement:function(e){var n=(null==e?void 0:e.from)||document.activeElement;if(null==n)return null;var t,r=s(),i=r.find(function(e){return!!(n.compareDocumentPosition(e)&(Node.DOCUMENT_POSITION_FOLLOWING|Node.DOCUMENT_POSITION_CONTAINED_BY))});return null==i&&null!=e&&e.wrap?null!=(t=r[0])?t:null:i},getPreviousFocusableElement:function(e){var n=(null==e?void 0:e.from)||document.activeElement;if(null==n)return null;for(var t,r=s(),i=r.length-1;i>=0;i--){var o=r[i];if(n.compareDocumentPosition(o)&(Node.DOCUMENT_POSITION_PRECEDING|Node.DOCUMENT_POSITION_CONTAINED_BY))return o}return null!=e&&e.wrap&&null!=(t=r[r.length-1])?t:null},getFirstFocusableElement:function(){var e;return null!=(e=s()[0])?e:null},getLastFocusableElement:function(){var e,n=s();return null!=(e=n[n.length-1])?e:null}}),this.actions=t.getActions(),this.monitor=t.getMonitor(),window.addEventListener("keydown",this.handleDraggedElementKeyDown,{capture:!0})}var n=e.prototype;return n.disconnect=function(){window.removeEventListener("keydown",this.handleDraggedElementKeyDown,{capture:!0})},n.hoverNode=function(e){var n,t=null==(n=Array.from(this.targetNodes.entries()).find(function(n){return e===n[1]}))?void 0:n[0];null!=t&&(this.actions.hover([t],{clientOffset:s(e)}),this.currentHoveredNode=e,this.previewer.render(this.monitor),this.announcer.announceHover(e,t),null==e||e.focus())},n.getNextDropTarget=function(){var e;return this.focusManager.getNextFocusableElement({wrap:!1,from:null!=(e=this.currentHoveredNode)?e:void 0})},n.getPreviousDropTarget=function(){var e;return this.focusManager.getPreviousFocusableElement({wrap:!1,from:null!=(e=this.currentHoveredNode)?e:void 0})},n.getViableTargets=function(e){return this.getAllowedTargets(e).sort(function(e,n){if(e===n)return 0;var t=e.compareDocumentPosition(n);return t&(Node.DOCUMENT_POSITION_FOLLOWING|t&Node.DOCUMENT_POSITION_CONTAINED_BY)?-1:t&(Node.DOCUMENT_POSITION_PRECEDING|t&Node.DOCUMENT_POSITION_CONTAINS)?1:0})},n.getAllowedTargets=function(e){var n=this;return null==this.monitor.getItemType()?Array.from(e.values()):Array.from(e).reduce(function(e,t){var r=t[0],i=t[1];return n.manager.getMonitor().canDropOnTarget(r)&&e.push(i),e},[])},e}();function c(e,n){var t;return void 0===n&&(n=!1),!(!n||!1!==e.isTrusted)||"d"===(null==(t=e.key)?void 0:t.toLowerCase())&&(e.metaKey||e.ctrlKey)&&!e.altKey}var l=[" ","Enter"],d=["Escape"];function h(e,n){return n.includes(e.key)}var v=function(){function e(e,n,t){var r,v=this;this.manager=void 0,this.actions=void 0,this.monitor=void 0,this.context=void 0,this.options=void 0,this.sourceNodes=void 0,this.sourcePreviewNodes=void 0,this.sourcePreviewNodeOptions=void 0,this.targetNodes=void 0,this._navigator=void 0,this._previewer=void 0,this._announcer=void 0,this._isDragTrigger=void 0,this._handlingFirstEvent=!1,this.handleGlobalKeyDown=function(e){if(v.monitor.isDragging()&&h(e,d)){v.endDrag(e);var n=String(v.monitor.getSourceId()),t=v.sourceNodes.get(n);v._announcer.announceCancel(null!=t?t:null,n)}},this.getSourceClientOffset=function(e){return s(v.sourceNodes.get(e))},this.handleDragStart=function(e,n){var t;if(v._isDragTrigger(n,v._handlingFirstEvent)&&(v._handlingFirstEvent=!1,v.monitor.canDragSource(e)))if(v.monitor.isDragging())v.actions.publishDragSource();else{a(n);var r=v.sourceNodes.get(e);null!=r&&(v._navigator=new u(r,v.targetNodes,v.manager,v._previewer,v._announcer),v._previewer.createDragPreview(null!=(t=v.sourcePreviewNodes.get(e))?t:r),v.actions.beginDrag([e],{clientOffset:v.getSourceClientOffset(e),getSourceClientOffset:v.getSourceClientOffset,publishSource:!1}),v._previewer.render(v.monitor),v.setDndMode(!0),v._announcer.announceDrag(r,e))}},this.handleDrop=function(e){if(h(e,l)){var n=String(v.monitor.getSourceId()),t=v.sourceNodes.get(n);v._announcer.announceDrop(null!=t?t:null,n),v.actions.drop(),v.endDrag(e)}},this.manager=e,this.actions=e.getActions(),this.monitor=e.getMonitor(),this.context=n,this.options=t,this._isDragTrigger=null!=(r=null==t?void 0:t.isDragTrigger)?r:c,this.sourceNodes=new Map,this.sourcePreviewNodes=new Map,this.sourcePreviewNodeOptions=new Map,this.targetNodes=new Map,this._previewer=new o(n.document,t),this._announcer=new i(t)}var n=e.prototype;return n.setup=function(){var n;if(e.isSetUp)throw new Error("Cannot have two Keyboard backends at the same time.");e.isSetUp=!0,this._handlingFirstEvent=!0,null==(n=this.context.window)||n.addEventListener("keydown",this.handleGlobalKeyDown,{capture:!0}),this._previewer.attach()},n.teardown=function(){var n;e.isSetUp=!1,null==(n=this.context.window)||n.removeEventListener("keydown",this.handleGlobalKeyDown,{capture:!0}),this.endDrag(),this._previewer.detach(),this._announcer.destroy()},n.setDndMode=function(e){var n;null==(n=this.options)||null==n.onDndModeChanged||n.onDndModeChanged(e)},n.profile=function(){return{sourcePreviewNodes:this.sourcePreviewNodes.size,sourcePreviewNodeOptions:this.sourcePreviewNodeOptions.size,sourceNodes:this.sourceNodes.size}},n.connectDragSource=function(e,n){var t=this,r=this.handleDragStart.bind(this,e);return this.sourceNodes.set(e,n),n.addEventListener("keydown",r),function(){t.sourceNodes.delete(e),n.removeEventListener("keydown",r)}},n.connectDragPreview=function(e,n,t){var r=this;return this.sourcePreviewNodeOptions.set(e,t),this.sourcePreviewNodes.set(e,n),function(){r.sourcePreviewNodes.delete(e),r.sourcePreviewNodeOptions.delete(e)}},n.connectDropTarget=function(e,n){var t=this;return this.targetNodes.set(e,n),n.addEventListener("keydown",this.handleDrop),n.tabIndex=Math.max(-1,n.tabIndex),function(){t.targetNodes.delete(e),n.removeEventListener("keydown",t.handleDrop)}},n.endDrag=function(e){var n;null!=e&&a(e),null==(n=this._navigator)||n.disconnect(),this._previewer.clear(),this.monitor.isDragging()&&this.actions.endDrag(),this.setDndMode(!1)},e}();v.isSetUp=void 0;var g=function(e,n,t){return new v(e,n,t)};export{v as KeyboardBackend,g as default,e as getNodeDescription,c as isKeyboardDragTrigger};
//# sourceMappingURL=index.module.js.map
